(()=>{"use strict";function t(t,e){const s=t.toLowerCase(),i=e.toLowerCase();return!s.includes("colab.research.google.com")&&(!!/\/\d{4}\/\d{2}\/\d{2}\//.test(t)||(!!["substack.com","medium.com","wikipedia.org"].some((t=>s.includes(t)))||!!["article","story","news","blog","post"].some((t=>s.includes(t)||i.includes(t)))))}async function e(){console.log("Starting history analysis.");const e=(new Date).getTime()-6048e5;try{const s=await chrome.history.search({text:"",startTime:e,maxResults:1e3});console.log(`Found ${s.length} history items.`);const i=await async function(e){const s=[],i=new Set;for(const n of e)if(t(n.url,n.title)&&!i.has(n.url)){i.add(n.url),console.log(`Analyzing article: ${n.url}, Visit count: ${n.visitCount}`);let t="";if(n.visitCount>=2)t="Multiple visits";else{const e=await chrome.history.getVisits({url:n.url});if(e.length>1){const s=e[e.length-1].visitTime-e[e.length-2].visitTime;console.log(`Time spent on ${n.url}: ${s}ms`),s>=18e4&&(t=(o=Math.round(s/6e4))>=60?"60+ minutes":`${o} minutes`)}}t&&s.push({url:n.url,title:n.title,visits:n.visitCount,lastVisit:new Date(n.lastVisitTime),timeSpent:t})}var o;return s}(s);i.sort(((t,e)=>e.lastVisit-t.lastVisit));const o=i.reduce(((t,e)=>{const s=e.lastVisit.toDateString();return t[s]||(t[s]=[]),t[s].push({...e,lastVisit:e.lastVisit.toLocaleString()}),t}),{});console.log(`Analysis complete. Found ${i.length} significant articles.`),await async function(t){return new Promise(((e,s)=>{chrome.storage.local.set({groupedArticles:t},(()=>{chrome.runtime.lastError?s(chrome.runtime.lastError):e()}))}))}(o),console.log("Saved grouped articles to storage.")}catch(t){console.error("Error during history analysis:",t)}}chrome.runtime.onInstalled.addListener((()=>{console.log("Read Recap installed. Running initial analysis."),e()})),chrome.runtime.onMessage.addListener(((t,s,i)=>("runDebug"===t.action&&(console.log("Debug request received. Running analysis."),e(),i({status:"success"})),!0))),chrome.alarms.create("checkHistory",{periodInMinutes:30}),chrome.alarms.onAlarm.addListener((t=>{"checkHistory"===t.name&&(console.log("Alarm triggered. Running analysis."),e())}))})();